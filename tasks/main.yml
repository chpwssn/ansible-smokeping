---
- name: install package smokeping and dependencies
  apt: pkg={{ item  }} state=present force=yes
  with_items:
    - smokeping
    - sendmail
    
- name: smokeping config for apache2
  template: src=etc/apache2/conf-available/smokeping.conf dest=/etc/apache2/conf-available/smokeping.conf
  notify: restart apache
  
- name: enable apache2 smokeping config
  command: a2enconf smokeping creates=/etc/apache2/conf-enabled/smokeping.conf
  notify: restart apache

- name: enable apache2 module cgi 
  command: a2enmod cgid creates=/etc/apache2/mods-enabled/cgid.load
  notify: restart apache

- name: config file - General  
  template: src=etc/smokeping/config.d/General.j2 dest=/etc/smokeping/config.d/General
  notify: 
    - restart smokeping
    - restart apache

- name: config file - Targets  
  template: src=etc/smokeping/config.d/Targets.j2 dest=/etc/smokeping/config.d/Targets
  notify: 
    - restart smokeping
    - restart apache
  tags: smokeping-targets
